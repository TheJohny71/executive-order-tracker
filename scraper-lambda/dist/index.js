"use strict";var S=Object.create;var c=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var O=(n,r)=>{for(var e in r)c(n,e,{get:r[e],enumerable:!0})},p=(n,r,e,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of h(r))!A.call(n,t)&&t!==e&&c(n,t,{get:()=>r[t],enumerable:!(o=f(r,t))||o.enumerable});return n};var g=(n,r,e)=>(e=n!=null?S(b(n)):{},p(r||!n||!n.__esModule?c(e,"default",{value:n,enumerable:!0}):e,n)),I=n=>p(c({},"__esModule",{value:!0}),n);var B={};O(B,{handler:()=>v});module.exports=I(B);var l=g(require("@sparticuz/chromium"),1),y=g(require("puppeteer-core"),1),w=require("@aws-sdk/client-dynamodb"),m=require("@aws-sdk/lib-dynamodb");var x=new w.DynamoDBClient({region:"us-east-2"}),P=m.DynamoDBDocumentClient.from(x),C="executive-orders",R=async n=>n.evaluate(()=>{let r=document.querySelector(".body-content"),e=document.querySelector(".news-item__excerpt");return{description:(r?.textContent?.trim()||e?.textContent?.trim()||"").substring(0,1e3)}}),M=async n=>{let r=Array.from({length:Math.ceil(n.length/25)},(e,o)=>n.slice(o*25,(o+1)*25));for(let e of r){let o=e.map(t=>({PutRequest:{Item:{pk:t.sourceId,sk:t.type,sourceId:t.sourceId,title:t.title,date:t.date,url:t.url,number:t.number,type:t.type,description:t.description,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}}));try{await P.send(new m.BatchWriteCommand({RequestItems:{[C]:o}})),console.log(`Successfully wrote ${e.length} orders to DynamoDB`)}catch(t){throw console.error("Error writing to DynamoDB:",t),t}}},v=async n=>{let r=null;try{console.log("Starting browser..."),r=await y.default.launch({args:[...l.default.args,"--disable-web-security","--ignore-certificate-errors"],defaultViewport:l.default.defaultViewport,executablePath:await l.default.executablePath(),headless:!0}),console.log("Browser started, opening White House page...");let e=await r.newPage();await e.setUserAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"),await e.goto("https://www.whitehouse.gov/briefing-room/presidential-actions/",{waitUntil:"networkidle0",timeout:3e4}),console.log("Page loaded, extracting data...");let o=await e.evaluate(()=>Array.from(document.querySelectorAll("article.news-item")).map(s=>{let i=s.querySelector(".news-item__title"),E=s.querySelector("time.entry-date"),d=s.querySelector("a")?.href||"",D=i?.textContent?.match(/(?:Executive Order|Presidential Memorandum) (\d+)/);return{title:i?.textContent?.trim()||"",date:E?.textContent?.trim()||"",url:d,type:d.toLowerCase().includes("executive-order")?"EXECUTIVE_ORDER":"PRESIDENTIAL_MEMORANDUM",number:D?.[1]||null,sourceId:d.split("/").slice(-2,-1)[0]||""}})),t=await Promise.all(o.map(async a=>{try{let s=await r.newPage();await s.setUserAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"),await s.goto(a.url,{waitUntil:"networkidle0",timeout:3e4});let i=await R(s);return await s.close(),{...a,description:i.description||""}}catch(s){return console.error(`Error fetching details for ${a.url}:`,s),{...a,description:""}}}));try{await M(t),console.log("Successfully saved all orders to DynamoDB")}catch(a){console.error("Failed to save orders to DynamoDB:",a)}let u={success:!0,orders:t,count:t.length,timestamp:new Date().toISOString()};return{statusCode:200,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify(u)}}catch(e){console.error("Scraping error:",e);let o={success:!1,message:"Scraping failed",error:e instanceof Error?e.message:"Unknown error"};return{statusCode:500,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify(o)}}finally{r!==null&&await r.close()}};0&&(module.exports={handler});
